<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Terminal</title>
<style>
  body {
    margin: 0;
    background: black;
    color: #00ff9c;
    font-family: "Courier New", monospace;
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #startScreen {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  #startBtn {
    background: black;
    color: #00ff9c;
    border: 2px solid #00ff9c;
    padding: 14px 30px;
    font-family: "Courier New", monospace;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 0 15px #00ff9c88;
    transition: all 0.3s ease;
  }

  #startBtn:hover {
    background: #00ff9c;
    color: black;
    box-shadow: 0 0 25px #00ff9c;
  }

  .terminal {
    width: 90%;
    max-width: 750px;
    border: 1px solid #00ff9c;
    padding: 20px;
    box-shadow: 0 0 20px #00ff9c55;
    display: none;
  }

  .input-line {
    display: flex;
  }

  .prompt {
    margin-right: 5px;
  }

  input {
    background: black;
    border: none;
    color: #00ff9c;
    outline: none;
    font-family: inherit;
    font-size: 16px;
    flex: 1;
  }
</style>
</head>
<body>

<div id="startScreen">
  <button id="startBtn">ğŸ’– Iniciar invitaciÃ³n</button>
</div>

<div class="terminal" id="terminal"></div>

<audio id="keySound" preload="auto">
  <source src="key.mp3" type="audio/mpeg">
</audio>

<script>
const terminal = document.getElementById("terminal");
const sound = document.getElementById("keySound");
const startBtn = document.getElementById("startBtn");
const startScreen = document.getElementById("startScreen");

let audioUnlocked = false;
let attempts = 0;
sound.volume = 0.2;

function playKeySound() {
  if (!audioUnlocked) return;
  sound.currentTime = 0;
  sound.play();
}

function unlockAudio() {
  if (audioUnlocked) return;
  sound.volume = 0;
  sound.play().then(() => {
    sound.pause();
    sound.currentTime = 0;
    sound.volume = 0.2;
    audioUnlocked = true;
  });
}

const lines = [
  "> initializing feelings...",
  "> loading memories... â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%",
  "> checking compatibility with Rowan...",
  "> result: PERFECT MATCH ğŸ’–",
  "",
  "> question:",
  "> Rowan, Â¿aceptas ser mi San ValentÃ­n este 14 de febrero?"
];

let line = 0;
let char = 0;

function typeLine() {
  if (line < lines.length) {
    if (char < lines[line].length) {
      terminal.innerHTML += lines[line].charAt(char);
      playKeySound();
      char++;
      setTimeout(typeLine, 80);
    } else {
      terminal.innerHTML += "<br>";
      char = 0;
      line++;
      setTimeout(typeLine, 400);
    }
  } else {
    showInput();
  }
}

/* âœ… INPUT CORREGIDO */
function showInput() {
  const wrapper = document.createElement("div");
  wrapper.className = "input-line";

  wrapper.innerHTML = `
    <span class="prompt">></span>
    <input type="text" autocomplete="off" />
  `;

  terminal.appendChild(wrapper);

  const input = wrapper.querySelector("input");
  input.focus();

  input.addEventListener("keydown", (e) => handleInput(e, wrapper));
}

function handleInput(e, wrapper) {
  playKeySound();

  if (e.key === "Enter") {
    const value = e.target.value.trim().toLowerCase();
    terminal.innerHTML += `> ${value}<br>`;
    wrapper.remove();

    if (value === "yes" || value === "sÃ­" || value === "si") {
      success();
    } else {
      attempts++;

      if (attempts === 1) {
        terminal.innerHTML += `> invalid option<br>`;
        terminal.innerHTML += `> hint: escribe "yes" ğŸ˜‰<br>`;
      } 
      else if (attempts === 2) {
        terminal.innerHTML += `> Â¿Sigues pensando...? ğŸ’­<br>`;
        terminal.innerHTML += `> solo escribe "yes"...<br>`;
      } 
      else {
        terminal.innerHTML += `> error: opciÃ³n incorrecta âŒ<br>`;
        terminal.innerHTML += `> sistema bloqueado hasta decir "yes" ğŸ˜ŒğŸ’–<br>`;
      }

      setTimeout(showInput, 200);
    }
  }
}

function typeCustomLines(customLines) {
  let l = 0;
  let c = 0;

  function write() {
    if (l < customLines.length) {
      if (c < customLines[l].length) {
        terminal.innerHTML += customLines[l].charAt(c);
        playKeySound();
        c++;
        setTimeout(write, 80);
      } else {
        terminal.innerHTML += "<br>";
        c = 0;
        l++;
        setTimeout(write, 400);
      }
    }
  }
  write();
}

function success() {
  const finalLines = [
    "> request accepted ğŸ’–",
    "> date confirmed: 14/02",
    "> message:",
    "> Ya quiero que sea 14....",
    "> ...",
    "> ...",
    "> nos vemos amor mÃ­o â¤ï¸"
  ];
  typeCustomLines(finalLines);
}

startBtn.addEventListener("click", () => {
  unlockAudio();
  startScreen.style.display = "none";
  terminal.style.display = "block";
  typeLine();
});
</script>

</body>
</html>
